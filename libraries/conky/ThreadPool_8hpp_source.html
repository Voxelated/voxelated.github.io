<!-- This file defines the header to use when generating documentation with -->
<!-- DoxyFormat.                                                            -->
<html>
  <head>
    <!-- Import Google Icon Font -->
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <!-- Let the browser know that the website is optimized for mobile -->
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <title>Conky : /home/joker/Voxel/Software/voxelated.github.io/scripts/Conky/include/Voxel/Conky/Container/ThreadPool.hpp Source File</title>
    <title>/home/joker/Voxel/Software/voxelated.github.io/scripts/Conky/include/Voxel/Conky/Container/ThreadPool.hpp Source File</title>
    <link rel="shortcut icon" href="VoxelLogoSmall.png">
    <script type="text/javascript" src="https://code.jquery.com/jquery-2.1.1.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/materialize/0.97.8/js/materialize.min.js"></script>
    <script type="text/javascript" src="dynsections.js"></script>
    <!-- NOTE: We first load the doxygen stylesheet, and then we try and load the stylesheet of the site
               to which this documentation will belong, and then we load the custom stylesheet
      -->
    <link href="doxygen.css" rel="stylesheet" type="text/css"/>
    <link href="/css/main.css" rel="stylesheet" type="text/css"/>
    <link href="sytlesheet.css" rel="stylesheet" type="text/css"/>
    <!-- Load the javascript which converts the doxygen output to material style -->
    <script type="text/javascript" src="DoxyFormat.js"></script>
  </head>
  <div class="navbar-fixed z-depth-1">
  <nav>
    <!--div class="nav-wrapper z-depth-1"-->
      <!-- All libraries are in the libraries/ dir, and the main index.html   -->
      <!-- is at ../                                                          -->
      <ul class="left">
        <li><a href="#" data-activates="slide-out" class="button-collapse"><i class="material-icons material-icons-logo">menu</i></a></li>
        <li><a href="https://voxelated.github.io/index.html" class="voxel-header-logo"><img src="VoxelLogoSmall.png" class="logo">oxel </a></li>
        <li><a href="https://voxelated.github.io/GettingStarted.html" class="voxel-navbar-element hide-on-med-and-down">GettingStarted</a></li>
        <li><a href="https://voxelated.github.io/Guides.html" class="voxel-navbar-element hide-on-med-and-down" >Guides</a></li>
        <li><a href="https://voxelated.github.io/Libraries.html" class="voxel-navbar-element hide-on-med-and-down">Libraries</a></li>
        <li><a href="https://github.com/Voxelated/Conky" class="voxel-navbar-element hide-on-med-and-down">Repository</a></li>
      </ul>
      <form>
        <div class="input-field hide-on-med-and-down right">
          <input id="search" type="search" placeholder="Search" required>
          <label for="search"><i class="material-icons">search</i></label>
          <i class="material-icons">close</i>
        </div>
      </form>
    <!--/div-->
  </nav>
  </div>
  <div class="col s2 m2 l3">
    <ul id="slide-out" class="side-nav z-depth-2 left-aligned">
      <li><a href="https://voxelated.github.io/GettingStarted.html">GettingStarted</a></li>
      <li><a href="https://voxelated.github.io/Guides.html">Guides</a></li>
      <li><a href="https://voxelated.github.io/Libraries.html" class="voxel-navbar-element">Libraries</a></li>
      <li><a href="https://github.com/Voxelated/Conky" class="voxel-navbar-element hide-on-med-and-down">Repository</a></li>
    </ul>
  </div>
  <body class="site">
    <div id="top">
      <div id="content" class="site-content">
        <div class="row">
          <div class="col s0 m2 l3"> 
          </div>
    <!-- The rest is filled by doxygen ... -->
<!-- Generated by Doxygen 1.8.13 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="dir_d44c64559bbebec7f509842c48db8b23.html">include</a></li><li class="navelem"><a class="el" href="dir_cfd7c35dcb1e9e7661ee231c78a28430.html">Voxel</a></li><li class="navelem"><a class="el" href="dir_ba210dc94deb9ea192b6f4b8d46cad72.html">Conky</a></li><li class="navelem"><a class="el" href="dir_66b8ff4100b30b2f8d60c48747f80f4e.html">Container</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">ThreadPool.hpp</div>  </div>
</div><!--header-->
<div class="contents">
<a href="ThreadPool_8hpp.html">Go to the documentation of this file.</a><div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;<span class="comment">//==--- Conky/Container/ThreadPool.hpp --------------------- -*- C++ -*- ---==//</span></div><div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;<span class="comment">//            </span></div><div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;<span class="comment">//                                Voxel : Conky</span></div><div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;<span class="comment">//</span></div><div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;<span class="comment">//                        Copyright (c) 2017 Rob Clucas</span></div><div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;<span class="comment">//  </span></div><div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;<span class="comment">//  This file is distributed under the MIT License. See LICENSE for details.</span></div><div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;<span class="comment">//</span></div><div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;<span class="comment">//==------------------------------------------------------------------------==//</span></div><div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;<span class="comment">//</span></div><div class="line"><a name="l00015"></a><span class="lineno">   15</span>&#160;<span class="comment"></span><span class="comment">//</span></div><div class="line"><a name="l00016"></a><span class="lineno">   16</span>&#160;<span class="comment">//==------------------------------------------------------------------------==//</span></div><div class="line"><a name="l00017"></a><span class="lineno">   17</span>&#160;</div><div class="line"><a name="l00018"></a><span class="lineno">   18</span>&#160;<span class="preprocessor">#pragma once</span></div><div class="line"><a name="l00019"></a><span class="lineno">   19</span>&#160;</div><div class="line"><a name="l00020"></a><span class="lineno">   20</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="Task_8hpp.html">Task.hpp</a>&quot;</span></div><div class="line"><a name="l00021"></a><span class="lineno">   21</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="ThreadPoolException_8hpp.html">ThreadPoolException.hpp</a>&quot;</span></div><div class="line"><a name="l00022"></a><span class="lineno">   22</span>&#160;<span class="preprocessor">#include &lt;<a class="code" href="StaticStealableQueue_8hpp.html">Voxel/Conky/Concurrent/StaticStealableQueue.hpp</a>&gt;</span></div><div class="line"><a name="l00023"></a><span class="lineno">   23</span>&#160;<span class="preprocessor">#include &lt;<a class="code" href="Thread_8hpp.html">Voxel/Conky/Thread/Thread.hpp</a>&gt;</span></div><div class="line"><a name="l00024"></a><span class="lineno">   24</span>&#160;<span class="preprocessor">#include &lt;Voxel/Thread/Thread.hpp&gt;</span></div><div class="line"><a name="l00025"></a><span class="lineno">   25</span>&#160;<span class="preprocessor">#include &lt;Voxel/SystemInfo/SystemInfo.hpp&gt;</span></div><div class="line"><a name="l00026"></a><span class="lineno">   26</span>&#160;<span class="preprocessor">#include &lt;thread&gt;</span></div><div class="line"><a name="l00027"></a><span class="lineno">   27</span>&#160;<span class="preprocessor">#include &lt;vector&gt;</span></div><div class="line"><a name="l00028"></a><span class="lineno">   28</span>&#160;</div><div class="line"><a name="l00029"></a><span class="lineno">   29</span>&#160;<span class="keyword">namespace </span><a class="code" href="namespaceVoxx.html">Voxx</a>  {</div><div class="line"><a name="l00030"></a><span class="lineno">   30</span>&#160;<span class="keyword">namespace </span>Conky {</div><div class="line"><a name="l00031"></a><span class="lineno">   31</span>&#160;</div><div class="line"><a name="l00034"></a><span class="lineno"><a class="line" href="ThreadPool_8hpp.html#a6afcd0d9a972f4517b317e62fe9b186e">   34</a></span>&#160;<span class="keyword">enum class</span> <a class="code" href="ThreadPool_8hpp.html#a6afcd0d9a972f4517b317e62fe9b186e">StealPolicy</a> : uint8_t {</div><div class="line"><a name="l00040"></a><span class="lineno">   40</span>&#160;  Random           = 0,</div><div class="line"><a name="l00055"></a><span class="lineno">   55</span>&#160;  NearestNeighbour = 1,</div><div class="line"><a name="l00061"></a><span class="lineno">   61</span>&#160;  Topological      = 2</div><div class="line"><a name="l00062"></a><span class="lineno">   62</span>&#160;};</div><div class="line"><a name="l00063"></a><span class="lineno">   63</span>&#160;</div><div class="line"><a name="l00082"></a><span class="lineno">   82</span>&#160;<span class="keyword">template</span> &lt;std::size_t TasksPerQueue                                         ,</div><div class="line"><a name="l00083"></a><span class="lineno">   83</span>&#160;          <a class="code" href="ThreadPool_8hpp.html#a6afcd0d9a972f4517b317e62fe9b186e">StealPolicy</a> Policy        = StealPolicy::NearestNeighbour         ,</div><div class="line"><a name="l00084"></a><span class="lineno">   84</span>&#160;          std::size_t TaskAlignment = System::destructiveInterfaceSize() * 2&gt;</div><div class="line"><a name="l00085"></a><span class="lineno"><a class="line" href="classVoxx_1_1Conky_1_1ThreadPool.html">   85</a></span>&#160;<span class="keyword">class </span><a class="code" href="classVoxx_1_1Conky_1_1ThreadPool.html">ThreadPool</a> {</div><div class="line"><a name="l00086"></a><span class="lineno">   86</span>&#160; <span class="keyword">public</span>:</div><div class="line"><a name="l00087"></a><span class="lineno">   87</span>&#160;  <span class="comment">//==--- Aliases ----------------------------------------------------------==//</span></div><div class="line"><a name="l00088"></a><span class="lineno">   88</span>&#160;  </div><div class="line"><a name="l00090"></a><span class="lineno"><a class="line" href="classVoxx_1_1Conky_1_1ThreadPool.html#a960384793661c3e689ec66eba93fac8b">   90</a></span>&#160;  <span class="keyword">using</span> <a class="code" href="structVoxx_1_1Conky_1_1Task.html">TaskType</a> = <a class="code" href="structVoxx_1_1Conky_1_1Task.html">Task&lt;TaskAlignment&gt;</a>;</div><div class="line"><a name="l00091"></a><span class="lineno">   91</span>&#160;</div><div class="line"><a name="l00092"></a><span class="lineno">   92</span>&#160; <span class="keyword">private</span>:</div><div class="line"><a name="l00093"></a><span class="lineno">   93</span>&#160;  <span class="comment">//==--- Structs ----------------------------------------------------------==//</span></div><div class="line"><a name="l00094"></a><span class="lineno">   94</span>&#160;  </div><div class="line"><a name="l00098"></a><span class="lineno">   98</span>&#160;  <span class="keyword">template</span> &lt;StealPolicy PolicyKind&gt;</div><div class="line"><a name="l00099"></a><span class="lineno"><a class="line" href="structVoxx_1_1Conky_1_1ThreadPool_1_1StealOverloader.html">   99</a></span>&#160;  <span class="keyword">struct </span><a class="code" href="structVoxx_1_1Conky_1_1ThreadPool_1_1StealOverloader.html">StealOverloader</a> {};</div><div class="line"><a name="l00100"></a><span class="lineno">  100</span>&#160;</div><div class="line"><a name="l00101"></a><span class="lineno">  101</span>&#160;  <span class="comment">//==--- Aliases ----------------------------------------------------------==//</span></div><div class="line"><a name="l00102"></a><span class="lineno">  102</span>&#160;  </div><div class="line"><a name="l00104"></a><span class="lineno"><a class="line" href="classVoxx_1_1Conky_1_1ThreadPool.html#a9c2e06efc92952cb5cc4acee06ed925b">  104</a></span>&#160;  <span class="keyword">using</span> <a class="code" href="structVoxx_1_1Conky_1_1ThreadPool_1_1StealOverloader.html">StealSelector</a>    = <a class="code" href="structVoxx_1_1Conky_1_1ThreadPool_1_1StealOverloader.html">StealOverloader&lt;Policy&gt;</a>;</div><div class="line"><a name="l00106"></a><span class="lineno"><a class="line" href="classVoxx_1_1Conky_1_1ThreadPool.html#a310b6404eb1992a2d2bd6ef3b9d0479e">  106</a></span>&#160;  <span class="keyword">using</span> <a class="code" href="structVoxx_1_1Conky_1_1ThreadPool_1_1StealOverloader.html">RandomSteal</a>      = <a class="code" href="structVoxx_1_1Conky_1_1ThreadPool_1_1StealOverloader.html">StealOverloader&lt;StealPolicy::Random&gt;</a>;</div><div class="line"><a name="l00108"></a><span class="lineno"><a class="line" href="classVoxx_1_1Conky_1_1ThreadPool.html#ac97f64095bb82d52b499b4eb7623f2cf">  108</a></span>&#160;  <span class="keyword">using</span> <a class="code" href="structVoxx_1_1Conky_1_1ThreadPool_1_1StealOverloader.html">NNeighbourSteal</a>  = <a class="code" href="structVoxx_1_1Conky_1_1ThreadPool_1_1StealOverloader.html">StealOverloader&lt;StealPolicy::NearestNeighbour&gt;</a>;</div><div class="line"><a name="l00110"></a><span class="lineno"><a class="line" href="classVoxx_1_1Conky_1_1ThreadPool.html#ad08ce9d50dffd50a91c1c92f4b53ea6b">  110</a></span>&#160;  <span class="keyword">using</span> <a class="code" href="structVoxx_1_1Conky_1_1ThreadPool_1_1StealOverloader.html">TopologicalSteal</a> = <a class="code" href="structVoxx_1_1Conky_1_1ThreadPool_1_1StealOverloader.html">StealOverloader&lt;StealPolicy::Topological&gt;</a>;</div><div class="line"><a name="l00111"></a><span class="lineno">  111</span>&#160;</div><div class="line"><a name="l00112"></a><span class="lineno">  112</span>&#160;  <span class="comment">//==--- Constants --------------------------------------------------------==//</span></div><div class="line"><a name="l00113"></a><span class="lineno">  113</span>&#160;</div><div class="line"><a name="l00117"></a><span class="lineno"><a class="line" href="classVoxx_1_1Conky_1_1ThreadPool.html#ab6ccf74a5181e5c0b284abcf3be7f66d">  117</a></span>&#160;  <span class="keyword">static</span> constexpr std::size_t queueAlignment = </div><div class="line"><a name="l00118"></a><span class="lineno">  118</span>&#160;    std::max(TaskAlignment, System::destructiveInterfaceSize());</div><div class="line"><a name="l00119"></a><span class="lineno">  119</span>&#160;</div><div class="line"><a name="l00121"></a><span class="lineno"><a class="line" href="structVoxx_1_1Conky_1_1ThreadPool_1_1TaskQueue.html">  121</a></span>&#160;  <span class="keyword">struct </span>alignas(queueAlignment) <a class="code" href="structVoxx_1_1Conky_1_1ThreadPool_1_1TaskQueue.html">TaskQueue</a> {</div><div class="line"><a name="l00122"></a><span class="lineno">  122</span>&#160;    <span class="comment">//==--- Aliases --------------------------------------------------------==//</span></div><div class="line"><a name="l00123"></a><span class="lineno">  123</span>&#160;  </div><div class="line"><a name="l00125"></a><span class="lineno"><a class="line" href="structVoxx_1_1Conky_1_1ThreadPool_1_1TaskQueue.html#ac325c349b20598a2831cb612d1ad9d8b">  125</a></span>&#160;    <span class="keyword">using</span> <a class="code" href="classVoxx_1_1Conky_1_1StaticStealableQueue.html">QueueType</a> = <a class="code" href="classVoxx_1_1Conky_1_1StaticStealableQueue.html">StaticStealableQueue&lt;TaskType, TasksPerQueue&gt;</a>; </div><div class="line"><a name="l00126"></a><span class="lineno">  126</span>&#160;</div><div class="line"><a name="l00127"></a><span class="lineno">  127</span>&#160;    <span class="comment">//==--- Members --------------------------------------------------------==//</span></div><div class="line"><a name="l00128"></a><span class="lineno">  128</span>&#160;    </div><div class="line"><a name="l00129"></a><span class="lineno"><a class="line" href="structVoxx_1_1Conky_1_1ThreadPool_1_1TaskQueue.html#adf9abffe8461993d2cbbb7f4e4a7041b">  129</a></span>&#160;    <a class="code" href="classVoxx_1_1Conky_1_1StaticStealableQueue.html">QueueType</a> <a class="code" href="structVoxx_1_1Conky_1_1ThreadPool_1_1TaskQueue.html#adf9abffe8461993d2cbbb7f4e4a7041b">tasks</a>; </div><div class="line"><a name="l00130"></a><span class="lineno">  130</span>&#160;</div><div class="line"><a name="l00131"></a><span class="lineno">  131</span>&#160;    <span class="comment">//==--- Con/destructors ------------------------------------------------==//</span></div><div class="line"><a name="l00132"></a><span class="lineno">  132</span>&#160;    </div><div class="line"><a name="l00134"></a><span class="lineno">  134</span>&#160;    <a class="code" href="structVoxx_1_1Conky_1_1ThreadPool_1_1TaskQueue.html">TaskQueue</a>() noexcept = default;</div><div class="line"><a name="l00135"></a><span class="lineno">  135</span>&#160;</div><div class="line"><a name="l00137"></a><span class="lineno">  137</span>&#160;    <a class="code" href="structVoxx_1_1Conky_1_1ThreadPool_1_1TaskQueue.html">TaskQueue</a>(<a class="code" href="structVoxx_1_1Conky_1_1ThreadPool_1_1TaskQueue.html">TaskQueue</a>&amp;&amp;)      = delete;</div><div class="line"><a name="l00139"></a><span class="lineno">  139</span>&#160;    <a class="code" href="structVoxx_1_1Conky_1_1ThreadPool_1_1TaskQueue.html">TaskQueue</a>(const <a class="code" href="structVoxx_1_1Conky_1_1ThreadPool_1_1TaskQueue.html">TaskQueue</a>&amp;) = delete;</div><div class="line"><a name="l00140"></a><span class="lineno">  140</span>&#160;</div><div class="line"><a name="l00141"></a><span class="lineno">  141</span>&#160;    <span class="comment">//== Operator overloads ------------------------------------------------==//</span></div><div class="line"><a name="l00142"></a><span class="lineno">  142</span>&#160;    </div><div class="line"><a name="l00144"></a><span class="lineno">  144</span>&#160;    <a class="code" href="structVoxx_1_1Conky_1_1ThreadPool_1_1TaskQueue.html">TaskQueue</a>&amp; operator=(<a class="code" href="structVoxx_1_1Conky_1_1ThreadPool_1_1TaskQueue.html">TaskQueue</a>&amp;&amp;)      = delete;</div><div class="line"><a name="l00146"></a><span class="lineno">  146</span>&#160;    <a class="code" href="structVoxx_1_1Conky_1_1ThreadPool_1_1TaskQueue.html">TaskQueue</a>&amp; operator=(const <a class="code" href="structVoxx_1_1Conky_1_1ThreadPool_1_1TaskQueue.html">TaskQueue</a>&amp;) = delete;</div><div class="line"><a name="l00147"></a><span class="lineno">  147</span>&#160;  };</div><div class="line"><a name="l00148"></a><span class="lineno">  148</span>&#160;</div><div class="line"><a name="l00149"></a><span class="lineno">  149</span>&#160; public:</div><div class="line"><a name="l00150"></a><span class="lineno">  150</span>&#160;  <span class="comment">//==--- Aliases ----------------------------------------------------------==//</span></div><div class="line"><a name="l00151"></a><span class="lineno">  151</span>&#160;</div><div class="line"><a name="l00153"></a><span class="lineno"><a class="line" href="classVoxx_1_1Conky_1_1ThreadPool.html#acdc979c231259442c770d1a4eef8709d">  153</a></span>&#160;  using <a class="code" href="classVoxx_1_1Conky_1_1ThreadPool.html#acdc979c231259442c770d1a4eef8709d">FlagContainer</a>   = std::vector&lt;uint8_t&gt;;</div><div class="line"><a name="l00155"></a><span class="lineno"><a class="line" href="classVoxx_1_1Conky_1_1ThreadPool.html#acf2725de2ad08dfa205e1055394c17a5">  155</a></span>&#160;  using <a class="code" href="classVoxx_1_1Conky_1_1ThreadPool.html#acf2725de2ad08dfa205e1055394c17a5">QueueContainer</a>  = std::vector&lt;<a class="code" href="structVoxx_1_1Conky_1_1ThreadPool_1_1TaskQueue.html">TaskQueue</a>&gt;;</div><div class="line"><a name="l00157"></a><span class="lineno"><a class="line" href="classVoxx_1_1Conky_1_1ThreadPool.html#a58e403696928c7b974efb78c4e628b88">  157</a></span>&#160;  using <a class="code" href="classVoxx_1_1Conky_1_1ThreadPool.html#a58e403696928c7b974efb78c4e628b88">ThreadContainer</a> = std::vector&lt;std::thread&gt;;</div><div class="line"><a name="l00158"></a><span class="lineno">  158</span>&#160;</div><div class="line"><a name="l00159"></a><span class="lineno">  159</span>&#160;  <span class="comment">//==--- Con-destruction --------------------------------------------------==//</span></div><div class="line"><a name="l00160"></a><span class="lineno">  160</span>&#160;  </div><div class="line"><a name="l00165"></a><span class="lineno"><a class="line" href="classVoxx_1_1Conky_1_1ThreadPool.html#a727edbad33f2f019ef1ea0d6931ec262">  165</a></span>&#160;  <a class="code" href="classVoxx_1_1Conky_1_1ThreadPool.html">ThreadPool</a>(std::<span class="keywordtype">size_t</span> numThreads)</div><div class="line"><a name="l00166"></a><span class="lineno">  166</span>&#160;  :   Flags(numThreads), Threads(0), TaskQueues(numThreads) {</div><div class="line"><a name="l00167"></a><span class="lineno">  167</span>&#160;    Debug::catcher([numThreads] () {</div><div class="line"><a name="l00168"></a><span class="lineno">  168</span>&#160;      <span class="keywordflow">if</span> (numThreads &gt; System::CpuInfo::cores())</div><div class="line"><a name="l00169"></a><span class="lineno">  169</span>&#160;        <span class="keywordflow">throw</span> <a class="code" href="classVoxx_1_1Conky_1_1ThreadPoolException.html">ThreadPoolException</a>(</div><div class="line"><a name="l00170"></a><span class="lineno">  170</span>&#160;          <a class="code" href="classVoxx_1_1Conky_1_1ThreadPoolException.html#a7d8dde22259d9772d9d6f80802c9e77da7b457d5bd516de9bd23b261f3e38cda6">ThreadPoolException::Type::Oversubscription</a>);</div><div class="line"><a name="l00171"></a><span class="lineno">  171</span>&#160;    });</div><div class="line"><a name="l00172"></a><span class="lineno">  172</span>&#160;</div><div class="line"><a name="l00173"></a><span class="lineno">  173</span>&#160;    <span class="comment">// The first thread is always the controlling thread.</span></div><div class="line"><a name="l00174"></a><span class="lineno">  174</span>&#160;    Voxx::Thread::setAffinity(0);</div><div class="line"><a name="l00175"></a><span class="lineno">  175</span>&#160;    makeWorkersRunnable();</div><div class="line"><a name="l00176"></a><span class="lineno">  176</span>&#160;    createWorkers(numThreads - 1);</div><div class="line"><a name="l00177"></a><span class="lineno">  177</span>&#160;  }</div><div class="line"><a name="l00178"></a><span class="lineno">  178</span>&#160;</div><div class="line"><a name="l00180"></a><span class="lineno"><a class="line" href="classVoxx_1_1Conky_1_1ThreadPool.html#a81a84af47e07fb0c71fa57cec712182e">  180</a></span>&#160;  <a class="code" href="classVoxx_1_1Conky_1_1ThreadPool.html#a81a84af47e07fb0c71fa57cec712182e">~ThreadPool</a>() noexcept {</div><div class="line"><a name="l00181"></a><span class="lineno">  181</span>&#160;    stopThreads();</div><div class="line"><a name="l00182"></a><span class="lineno">  182</span>&#160;    join();</div><div class="line"><a name="l00183"></a><span class="lineno">  183</span>&#160;  }</div><div class="line"><a name="l00184"></a><span class="lineno">  184</span>&#160;</div><div class="line"><a name="l00185"></a><span class="lineno">  185</span>&#160;  <span class="comment">//==--- Methods ----------------------------------------------------------==//</span></div><div class="line"><a name="l00186"></a><span class="lineno">  186</span>&#160;  </div><div class="line"><a name="l00193"></a><span class="lineno">  193</span>&#160;  <span class="keyword">template</span> &lt;<span class="keyword">typename</span> TaskCallable, <span class="keyword">typename</span>... TaskArgs&gt;</div><div class="line"><a name="l00194"></a><span class="lineno"><a class="line" href="classVoxx_1_1Conky_1_1ThreadPool.html#abc541275693b3cd0b99759ef2802a511">  194</a></span>&#160;  <span class="keywordtype">bool</span> <a class="code" href="classVoxx_1_1Conky_1_1ThreadPool.html#abc541275693b3cd0b99759ef2802a511">tryPush</a>(TaskCallable&amp;&amp; callable, TaskArgs&amp;&amp;... args) {</div><div class="line"><a name="l00195"></a><span class="lineno">  195</span>&#160;    <span class="keyword">auto</span>&amp; tasks = TaskQueues[Thread::threadId].tasks;</div><div class="line"><a name="l00196"></a><span class="lineno">  196</span>&#160;    <span class="keywordflow">if</span> (tasks.<a class="code" href="classVoxx_1_1Conky_1_1StaticStealableQueue.html#ab760e0c87afa15777c50d0144dfaf4ae">size</a>() &gt;= TasksPerQueue) {</div><div class="line"><a name="l00197"></a><span class="lineno">  197</span>&#160;      <span class="comment">// co_await pop();</span></div><div class="line"><a name="l00198"></a><span class="lineno">  198</span>&#160;      <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l00199"></a><span class="lineno">  199</span>&#160;    }</div><div class="line"><a name="l00200"></a><span class="lineno">  200</span>&#160;</div><div class="line"><a name="l00201"></a><span class="lineno">  201</span>&#160;    tasks.<a class="code" href="classVoxx_1_1Conky_1_1StaticStealableQueue.html#ad998a47e79e51b7edcba2f53e30d6380">push</a>(std::forward&lt;TaskCallable&gt;(callable) ,</div><div class="line"><a name="l00202"></a><span class="lineno">  202</span>&#160;               std::forward&lt;TaskArgs&gt;(args)...      );</div><div class="line"><a name="l00203"></a><span class="lineno">  203</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">true</span>;</div><div class="line"><a name="l00204"></a><span class="lineno">  204</span>&#160;  }</div><div class="line"><a name="l00205"></a><span class="lineno">  205</span>&#160; </div><div class="line"><a name="l00207"></a><span class="lineno"><a class="line" href="classVoxx_1_1Conky_1_1ThreadPool.html#a6cb0c21fdfe3457231abe6b9c01fcd3d">  207</a></span>&#160;  <span class="keywordtype">void</span> <a class="code" href="classVoxx_1_1Conky_1_1ThreadPool.html#a6cb0c21fdfe3457231abe6b9c01fcd3d">stopThreads</a>() noexcept {</div><div class="line"><a name="l00208"></a><span class="lineno">  208</span>&#160;    <span class="keywordflow">for</span> (<span class="keyword">auto</span>&amp; flag : Flags) {</div><div class="line"><a name="l00209"></a><span class="lineno">  209</span>&#160;      flag = <span class="keyword">false</span>;   </div><div class="line"><a name="l00210"></a><span class="lineno">  210</span>&#160;    }</div><div class="line"><a name="l00211"></a><span class="lineno">  211</span>&#160;  }</div><div class="line"><a name="l00212"></a><span class="lineno">  212</span>&#160;</div><div class="line"><a name="l00218"></a><span class="lineno"><a class="line" href="classVoxx_1_1Conky_1_1ThreadPool.html#a2c219ac4227a19f806110246c349f561">  218</a></span>&#160;  <span class="keywordtype">void</span> <a class="code" href="classVoxx_1_1Conky_1_1ThreadPool.html#a2c219ac4227a19f806110246c349f561">startThreads</a>() noexcept {</div><div class="line"><a name="l00219"></a><span class="lineno">  219</span>&#160;    <span class="keywordflow">if</span> (Thread::threadId == 0) {</div><div class="line"><a name="l00220"></a><span class="lineno">  220</span>&#160;      restartThreads();</div><div class="line"><a name="l00221"></a><span class="lineno">  221</span>&#160;    } <span class="keywordflow">else</span> {</div><div class="line"><a name="l00222"></a><span class="lineno">  222</span>&#160;      <span class="keyword">auto</span> restarter = std::thread([<span class="keyword">this</span>] {</div><div class="line"><a name="l00223"></a><span class="lineno">  223</span>&#160;        ::Voxx::Thread::setAffinity(0);</div><div class="line"><a name="l00224"></a><span class="lineno">  224</span>&#160;        this-&gt;restartThreads();</div><div class="line"><a name="l00225"></a><span class="lineno">  225</span>&#160;      });</div><div class="line"><a name="l00226"></a><span class="lineno">  226</span>&#160;      restarter.join();</div><div class="line"><a name="l00227"></a><span class="lineno">  227</span>&#160;    }</div><div class="line"><a name="l00228"></a><span class="lineno">  228</span>&#160;  }</div><div class="line"><a name="l00229"></a><span class="lineno">  229</span>&#160;</div><div class="line"><a name="l00232"></a><span class="lineno"><a class="line" href="classVoxx_1_1Conky_1_1ThreadPool.html#a0159256530cb47af45cf42a848109e46">  232</a></span>&#160;  std::size_t <a class="code" href="classVoxx_1_1Conky_1_1ThreadPool.html#a0159256530cb47af45cf42a848109e46">runningThreads</a>() const noexcept {</div><div class="line"><a name="l00233"></a><span class="lineno">  233</span>&#160;    std::size_t count = 0;</div><div class="line"><a name="l00234"></a><span class="lineno">  234</span>&#160;    <span class="keywordflow">for</span> (<span class="keyword">const</span> <span class="keyword">auto</span>&amp; flag : Flags)</div><div class="line"><a name="l00235"></a><span class="lineno">  235</span>&#160;      count += flag;</div><div class="line"><a name="l00236"></a><span class="lineno">  236</span>&#160;    <span class="keywordflow">return</span> count;</div><div class="line"><a name="l00237"></a><span class="lineno">  237</span>&#160;  }</div><div class="line"><a name="l00238"></a><span class="lineno">  238</span>&#160;</div><div class="line"><a name="l00240"></a><span class="lineno"><a class="line" href="classVoxx_1_1Conky_1_1ThreadPool.html#ae2f5327241efc9ba7e69194b0b110a52">  240</a></span>&#160;  <span class="keywordtype">void</span> <a class="code" href="classVoxx_1_1Conky_1_1ThreadPool.html#ae2f5327241efc9ba7e69194b0b110a52">waitTillIdle</a>() const noexcept {</div><div class="line"><a name="l00241"></a><span class="lineno">  241</span>&#160;    <span class="keywordflow">while</span> (!isEmpty()) { <span class="comment">/* Spin ... */</span> }</div><div class="line"><a name="l00242"></a><span class="lineno">  242</span>&#160;  }</div><div class="line"><a name="l00243"></a><span class="lineno">  243</span>&#160;</div><div class="line"><a name="l00246"></a><span class="lineno"><a class="line" href="classVoxx_1_1Conky_1_1ThreadPool.html#a6e711954f70e25be86d01b32562d12e3">  246</a></span>&#160;  <span class="keywordtype">bool</span> <a class="code" href="classVoxx_1_1Conky_1_1ThreadPool.html#a6e711954f70e25be86d01b32562d12e3">isEmpty</a>() const noexcept {</div><div class="line"><a name="l00247"></a><span class="lineno">  247</span>&#160;    <span class="keywordflow">for</span> (<span class="keyword">const</span> <span class="keyword">auto</span>&amp; queue : TaskQueues)</div><div class="line"><a name="l00248"></a><span class="lineno">  248</span>&#160;      <span class="keywordflow">if</span> (queue.tasks.size())</div><div class="line"><a name="l00249"></a><span class="lineno">  249</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l00250"></a><span class="lineno">  250</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">true</span>;</div><div class="line"><a name="l00251"></a><span class="lineno">  251</span>&#160;  }</div><div class="line"><a name="l00252"></a><span class="lineno">  252</span>&#160;</div><div class="line"><a name="l00253"></a><span class="lineno">  253</span>&#160; <span class="keyword">private</span>:</div><div class="line"><a name="l00254"></a><span class="lineno">  254</span>&#160;  <span class="comment">//==--- Members ----------------------------------------------------------==//</span></div><div class="line"><a name="l00255"></a><span class="lineno">  255</span>&#160;  </div><div class="line"><a name="l00256"></a><span class="lineno"><a class="line" href="classVoxx_1_1Conky_1_1ThreadPool.html#ac3e5ea78b072c672896ea4c0bbc3dd64">  256</a></span>&#160;  <a class="code" href="classVoxx_1_1Conky_1_1ThreadPool.html#acdc979c231259442c770d1a4eef8709d">FlagContainer</a>   <a class="code" href="classVoxx_1_1Conky_1_1ThreadPool.html#ac3e5ea78b072c672896ea4c0bbc3dd64">Flags</a>;      </div><div class="line"><a name="l00257"></a><span class="lineno"><a class="line" href="classVoxx_1_1Conky_1_1ThreadPool.html#a391a28760a2639e432f63e4bfe68d391">  257</a></span>&#160;  <a class="code" href="classVoxx_1_1Conky_1_1ThreadPool.html#a58e403696928c7b974efb78c4e628b88">ThreadContainer</a> <a class="code" href="classVoxx_1_1Conky_1_1ThreadPool.html#a391a28760a2639e432f63e4bfe68d391">Threads</a>;    </div><div class="line"><a name="l00258"></a><span class="lineno"><a class="line" href="classVoxx_1_1Conky_1_1ThreadPool.html#ac2afd11f433203a5408138b610729df1">  258</a></span>&#160;  <a class="code" href="classVoxx_1_1Conky_1_1ThreadPool.html#acf2725de2ad08dfa205e1055394c17a5">QueueContainer</a>  <a class="code" href="classVoxx_1_1Conky_1_1ThreadPool.html#ac2afd11f433203a5408138b610729df1">TaskQueues</a>; </div><div class="line"><a name="l00259"></a><span class="lineno">  259</span>&#160;  </div><div class="line"><a name="l00260"></a><span class="lineno">  260</span>&#160;  <span class="comment">//==--- Methods ----------------------------------------------------------==//</span></div><div class="line"><a name="l00261"></a><span class="lineno">  261</span>&#160;</div><div class="line"><a name="l00265"></a><span class="lineno"><a class="line" href="classVoxx_1_1Conky_1_1ThreadPool.html#a3ea01dcd3f395c76225fb2d4982faeed">  265</a></span>&#160;  <span class="keywordtype">bool</span> <a class="code" href="classVoxx_1_1Conky_1_1ThreadPool.html#a3ea01dcd3f395c76225fb2d4982faeed">runnable</a>(std::size_t workerId) <span class="keyword">const</span> noexcept {</div><div class="line"><a name="l00266"></a><span class="lineno">  266</span>&#160;    <span class="keywordflow">return</span> Flags[workerId];</div><div class="line"><a name="l00267"></a><span class="lineno">  267</span>&#160;  }                                   </div><div class="line"><a name="l00268"></a><span class="lineno">  268</span>&#160;</div><div class="line"><a name="l00270"></a><span class="lineno"><a class="line" href="classVoxx_1_1Conky_1_1ThreadPool.html#a5293f196b6d53fb76105ff11141bf739">  270</a></span>&#160;  <span class="keywordtype">void</span> <a class="code" href="classVoxx_1_1Conky_1_1ThreadPool.html#a5293f196b6d53fb76105ff11141bf739">createWorkers</a>(std::size_t numThreads) {</div><div class="line"><a name="l00271"></a><span class="lineno">  271</span>&#160;    <span class="comment">// TODO: Change this to get a proper thread index.</span></div><div class="line"><a name="l00272"></a><span class="lineno">  272</span>&#160;    <span class="keywordflow">for</span> (std::size_t i = 0; i &lt; numThreads; ++i)</div><div class="line"><a name="l00273"></a><span class="lineno">  273</span>&#160;      Threads.push_back(std::thread(&amp;<a class="code" href="classVoxx_1_1Conky_1_1ThreadPool.html#a224ea04d1be262820d942f781353e69d">ThreadPool::process</a>, <span class="keyword">this</span>, i + 1));</div><div class="line"><a name="l00274"></a><span class="lineno">  274</span>&#160;  }</div><div class="line"><a name="l00275"></a><span class="lineno">  275</span>&#160;</div><div class="line"><a name="l00277"></a><span class="lineno"><a class="line" href="classVoxx_1_1Conky_1_1ThreadPool.html#ad156d5942b00d229c41915c94cfbc64c">  277</a></span>&#160;  <span class="keywordtype">void</span> <a class="code" href="classVoxx_1_1Conky_1_1ThreadPool.html#ad156d5942b00d229c41915c94cfbc64c">makeWorkersRunnable</a>() noexcept {</div><div class="line"><a name="l00278"></a><span class="lineno">  278</span>&#160;    <span class="keywordflow">for</span> (<span class="keyword">auto</span>&amp; flag : Flags) {</div><div class="line"><a name="l00279"></a><span class="lineno">  279</span>&#160;      flag = <span class="keyword">true</span>;</div><div class="line"><a name="l00280"></a><span class="lineno">  280</span>&#160;    }</div><div class="line"><a name="l00281"></a><span class="lineno">  281</span>&#160;  }</div><div class="line"><a name="l00282"></a><span class="lineno">  282</span>&#160;</div><div class="line"><a name="l00284"></a><span class="lineno"><a class="line" href="classVoxx_1_1Conky_1_1ThreadPool.html#acf67028a501af41702b50c666ee8a4ce">  284</a></span>&#160;  <span class="keywordtype">void</span> <a class="code" href="classVoxx_1_1Conky_1_1ThreadPool.html#acf67028a501af41702b50c666ee8a4ce">join</a>() noexcept {</div><div class="line"><a name="l00285"></a><span class="lineno">  285</span>&#160;    <span class="keywordflow">if</span> (Thread::threadId == 0) {</div><div class="line"><a name="l00286"></a><span class="lineno">  286</span>&#160;      <span class="keywordflow">for</span> (<span class="keyword">auto</span>&amp; thread : Threads) {</div><div class="line"><a name="l00287"></a><span class="lineno">  287</span>&#160;        <span class="keywordflow">if</span> (thread.joinable()) {</div><div class="line"><a name="l00288"></a><span class="lineno">  288</span>&#160;          thread.join();</div><div class="line"><a name="l00289"></a><span class="lineno">  289</span>&#160;        }</div><div class="line"><a name="l00290"></a><span class="lineno">  290</span>&#160;      }</div><div class="line"><a name="l00291"></a><span class="lineno">  291</span>&#160;    }</div><div class="line"><a name="l00292"></a><span class="lineno">  292</span>&#160;  }</div><div class="line"><a name="l00293"></a><span class="lineno">  293</span>&#160;</div><div class="line"><a name="l00298"></a><span class="lineno"><a class="line" href="classVoxx_1_1Conky_1_1ThreadPool.html#a04db1c102afea56bd8e91c43a88ae34b">  298</a></span>&#160;  <span class="keywordtype">void</span> <a class="code" href="classVoxx_1_1Conky_1_1ThreadPool.html#a04db1c102afea56bd8e91c43a88ae34b">restartThreads</a>() {</div><div class="line"><a name="l00299"></a><span class="lineno">  299</span>&#160;    <span class="keywordflow">if</span> (Thread::threadId == 0) {</div><div class="line"><a name="l00300"></a><span class="lineno">  300</span>&#160;      std::size_t i = 0;</div><div class="line"><a name="l00301"></a><span class="lineno">  301</span>&#160;      Flags[0]      = <span class="keyword">true</span>;</div><div class="line"><a name="l00302"></a><span class="lineno">  302</span>&#160;      <span class="keywordflow">for</span> (<span class="keyword">auto</span>&amp; thread : Threads) {</div><div class="line"><a name="l00303"></a><span class="lineno">  303</span>&#160;        <span class="keyword">auto</span>&amp; runnableFlag = Flags[++i];</div><div class="line"><a name="l00304"></a><span class="lineno">  304</span>&#160;</div><div class="line"><a name="l00305"></a><span class="lineno">  305</span>&#160;        <span class="comment">// If the thread has not been set to stop, there is no point in creating</span></div><div class="line"><a name="l00306"></a><span class="lineno">  306</span>&#160;        <span class="comment">// a new one, rather just leave the old one runnig.</span></div><div class="line"><a name="l00307"></a><span class="lineno">  307</span>&#160;        <span class="keywordflow">if</span> (runnableFlag) {</div><div class="line"><a name="l00308"></a><span class="lineno">  308</span>&#160;          <span class="keywordflow">continue</span>;</div><div class="line"><a name="l00309"></a><span class="lineno">  309</span>&#160;        }</div><div class="line"><a name="l00310"></a><span class="lineno">  310</span>&#160;</div><div class="line"><a name="l00311"></a><span class="lineno">  311</span>&#160;        runnableFlag = <span class="keyword">false</span>;</div><div class="line"><a name="l00312"></a><span class="lineno">  312</span>&#160;        <span class="keywordflow">if</span> (thread.joinable()) {</div><div class="line"><a name="l00313"></a><span class="lineno">  313</span>&#160;          thread.join();</div><div class="line"><a name="l00314"></a><span class="lineno">  314</span>&#160;        }</div><div class="line"><a name="l00315"></a><span class="lineno">  315</span>&#160;</div><div class="line"><a name="l00316"></a><span class="lineno">  316</span>&#160;        runnableFlag = <span class="keyword">true</span>;</div><div class="line"><a name="l00317"></a><span class="lineno">  317</span>&#160;        thread = std::move(std::thread(&amp;<a class="code" href="classVoxx_1_1Conky_1_1ThreadPool.html#a224ea04d1be262820d942f781353e69d">ThreadPool::process</a>, <span class="keyword">this</span>, i));</div><div class="line"><a name="l00318"></a><span class="lineno">  318</span>&#160;      }</div><div class="line"><a name="l00319"></a><span class="lineno">  319</span>&#160;    }</div><div class="line"><a name="l00320"></a><span class="lineno">  320</span>&#160;  }</div><div class="line"><a name="l00321"></a><span class="lineno">  321</span>&#160;</div><div class="line"><a name="l00325"></a><span class="lineno"><a class="line" href="classVoxx_1_1Conky_1_1ThreadPool.html#a224ea04d1be262820d942f781353e69d">  325</a></span>&#160;  <span class="keywordtype">void</span> <a class="code" href="classVoxx_1_1Conky_1_1ThreadPool.html#a224ea04d1be262820d942f781353e69d">process</a>(std::size_t workerId) {</div><div class="line"><a name="l00326"></a><span class="lineno">  326</span>&#160;    <span class="keyword">using namespace </span>std::experimental;</div><div class="line"><a name="l00327"></a><span class="lineno">  327</span>&#160;    Voxx::Thread::setAffinity(workerId);</div><div class="line"><a name="l00328"></a><span class="lineno">  328</span>&#160;</div><div class="line"><a name="l00329"></a><span class="lineno">  329</span>&#160;    <span class="comment">// The global threadId, which can be used in client code to identify the</span></div><div class="line"><a name="l00330"></a><span class="lineno">  330</span>&#160;    <span class="comment">// thread, is set to __id__ value so that when pushing to the thread pool</span></div><div class="line"><a name="l00331"></a><span class="lineno">  331</span>&#160;    <span class="comment">// the correct worker can be accessed extremely quickly.</span></div><div class="line"><a name="l00332"></a><span class="lineno">  332</span>&#160;    <span class="keywordflow">if</span> (Thread::threadId != workerId) {</div><div class="line"><a name="l00333"></a><span class="lineno">  333</span>&#160;      Thread::threadId = workerId;</div><div class="line"><a name="l00334"></a><span class="lineno">  334</span>&#160;    }</div><div class="line"><a name="l00335"></a><span class="lineno">  335</span>&#160;</div><div class="line"><a name="l00336"></a><span class="lineno">  336</span>&#160;    <span class="keywordflow">while</span> (runnable(workerId)) {</div><div class="line"><a name="l00337"></a><span class="lineno">  337</span>&#160;      processImpl(workerId);</div><div class="line"><a name="l00338"></a><span class="lineno">  338</span>&#160;    }</div><div class="line"><a name="l00339"></a><span class="lineno">  339</span>&#160;  }</div><div class="line"><a name="l00340"></a><span class="lineno">  340</span>&#160;</div><div class="line"><a name="l00342"></a><span class="lineno"><a class="line" href="classVoxx_1_1Conky_1_1ThreadPool.html#a13dadf2d25521153dc53dae7a7f06cbb">  342</a></span>&#160;  <span class="keywordtype">void</span> <a class="code" href="classVoxx_1_1Conky_1_1ThreadPool.html#a13dadf2d25521153dc53dae7a7f06cbb">processImpl</a>(std::size_t workerId) {</div><div class="line"><a name="l00343"></a><span class="lineno">  343</span>&#160;    <span class="keywordflow">if</span> (<span class="keyword">auto</span> task = TaskQueues[workerId].tasks.<a class="code" href="classVoxx_1_1Conky_1_1StaticStealableQueue.html#a9e9473b950c7ecdffb7482607ccb5bf4">pop</a>()) {</div><div class="line"><a name="l00344"></a><span class="lineno">  344</span>&#160;      task-&gt;executor-&gt;execute();</div><div class="line"><a name="l00345"></a><span class="lineno">  345</span>&#160;      <span class="keywordflow">return</span>;</div><div class="line"><a name="l00346"></a><span class="lineno">  346</span>&#160;    }</div><div class="line"><a name="l00347"></a><span class="lineno">  347</span>&#160;    steal(workerId, <a class="code" href="structVoxx_1_1Conky_1_1ThreadPool_1_1StealOverloader.html">StealSelector</a>());</div><div class="line"><a name="l00348"></a><span class="lineno">  348</span>&#160;  }</div><div class="line"><a name="l00349"></a><span class="lineno">  349</span>&#160;</div><div class="line"><a name="l00354"></a><span class="lineno"><a class="line" href="classVoxx_1_1Conky_1_1ThreadPool.html#a622696b6cfc49ad93a79cab5c6aeab26">  354</a></span>&#160;  <span class="keywordtype">void</span> <a class="code" href="classVoxx_1_1Conky_1_1ThreadPool.html#a622696b6cfc49ad93a79cab5c6aeab26">steal</a>(std::size_t workerId, <a class="code" href="structVoxx_1_1Conky_1_1ThreadPool_1_1StealOverloader.html">RandomSteal</a> tag) {</div><div class="line"><a name="l00355"></a><span class="lineno">  355</span>&#160;    <span class="keyword">auto</span>&amp; tasks = TaskQueues[Math::randint(0, TaskQueues.size())].tasks;</div><div class="line"><a name="l00356"></a><span class="lineno">  356</span>&#160;    <span class="keywordflow">if</span> (<span class="keyword">auto</span> task = tasks.<a class="code" href="classVoxx_1_1Conky_1_1StaticStealableQueue.html#ad74563cd73ea66a74edd8e8b1cb50dc6">steal</a>()) {</div><div class="line"><a name="l00357"></a><span class="lineno">  357</span>&#160;      task-&gt;executor-&gt;execute();</div><div class="line"><a name="l00358"></a><span class="lineno">  358</span>&#160;    }</div><div class="line"><a name="l00359"></a><span class="lineno">  359</span>&#160;  }</div><div class="line"><a name="l00360"></a><span class="lineno">  360</span>&#160;</div><div class="line"><a name="l00365"></a><span class="lineno"><a class="line" href="classVoxx_1_1Conky_1_1ThreadPool.html#ab9ba93f24dae63fa4361b01bc970d4a6">  365</a></span>&#160;  <span class="keywordtype">void</span> <a class="code" href="classVoxx_1_1Conky_1_1ThreadPool.html#ab9ba93f24dae63fa4361b01bc970d4a6">steal</a>(std::size_t workerId, <a class="code" href="structVoxx_1_1Conky_1_1ThreadPool_1_1StealOverloader.html">NNeighbourSteal</a> tag) {</div><div class="line"><a name="l00366"></a><span class="lineno">  366</span>&#160;    <span class="keywordflow">for</span> (std::size_t offset = 1; offset &lt; TaskQueues.size(); ++offset) {</div><div class="line"><a name="l00367"></a><span class="lineno">  367</span>&#160;      <span class="keyword">auto</span>&amp; tasks = TaskQueues[(workerId + offset) % TaskQueues.size()].tasks;</div><div class="line"><a name="l00368"></a><span class="lineno">  368</span>&#160;      <span class="keywordflow">if</span> (<span class="keyword">auto</span> task = tasks.<a class="code" href="classVoxx_1_1Conky_1_1StaticStealableQueue.html#ad74563cd73ea66a74edd8e8b1cb50dc6">steal</a>()) {</div><div class="line"><a name="l00369"></a><span class="lineno">  369</span>&#160;        task-&gt;executor-&gt;execute();</div><div class="line"><a name="l00370"></a><span class="lineno">  370</span>&#160;        <span class="keywordflow">return</span>;</div><div class="line"><a name="l00371"></a><span class="lineno">  371</span>&#160;      }</div><div class="line"><a name="l00372"></a><span class="lineno">  372</span>&#160;    }</div><div class="line"><a name="l00373"></a><span class="lineno">  373</span>&#160;  }</div><div class="line"><a name="l00374"></a><span class="lineno">  374</span>&#160;};</div><div class="line"><a name="l00375"></a><span class="lineno">  375</span>&#160;</div><div class="line"><a name="l00376"></a><span class="lineno">  376</span>&#160;}} <span class="comment">// namespace Voxx::Conky</span></div><div class="ttc" id="classVoxx_1_1Conky_1_1ThreadPool_html_acf2725de2ad08dfa205e1055394c17a5"><div class="ttname"><a href="classVoxx_1_1Conky_1_1ThreadPool.html#acf2725de2ad08dfa205e1055394c17a5">Voxx::Conky::ThreadPool::QueueContainer</a></div><div class="ttdeci">std::vector&lt; TaskQueue &gt; QueueContainer</div><div class="ttdoc">Defines the type of container for the queues. </div><div class="ttdef"><b>Definition:</b> ThreadPool.hpp:155</div></div>
<div class="ttc" id="structVoxx_1_1Conky_1_1Task_html"><div class="ttname"><a href="structVoxx_1_1Conky_1_1Task.html">Voxx::Conky::Task</a></div><div class="ttdoc">A task is essentially some body of work which needs to be done. </div><div class="ttdef"><b>Definition:</b> Task.hpp:139</div></div>
<div class="ttc" id="classVoxx_1_1Conky_1_1StaticStealableQueue_html_a9e9473b950c7ecdffb7482607ccb5bf4"><div class="ttname"><a href="classVoxx_1_1Conky_1_1StaticStealableQueue.html#a9e9473b950c7ecdffb7482607ccb5bf4">Voxx::Conky::StaticStealableQueue::pop</a></div><div class="ttdeci">OptionalType pop()</div><div class="ttdoc">Pops an object from the front of the queue. </div><div class="ttdef"><b>Definition:</b> StaticStealableQueue.hpp:152</div></div>
<div class="ttc" id="structVoxx_1_1Conky_1_1ThreadPool_1_1TaskQueue_html_adf9abffe8461993d2cbbb7f4e4a7041b"><div class="ttname"><a href="structVoxx_1_1Conky_1_1ThreadPool_1_1TaskQueue.html#adf9abffe8461993d2cbbb7f4e4a7041b">Voxx::Conky::ThreadPool::TaskQueue::tasks</a></div><div class="ttdeci">QueueType tasks</div><div class="ttdoc">The queue of tasks to be executed by workers. </div><div class="ttdef"><b>Definition:</b> ThreadPool.hpp:129</div></div>
<div class="ttc" id="classVoxx_1_1Conky_1_1StaticStealableQueue_html_ab760e0c87afa15777c50d0144dfaf4ae"><div class="ttname"><a href="classVoxx_1_1Conky_1_1StaticStealableQueue.html#ab760e0c87afa15777c50d0144dfaf4ae">Voxx::Conky::StaticStealableQueue::size</a></div><div class="ttdeci">SizeType size() const noexcept</div><div class="ttdoc">Returns the number of elements in the queue. </div><div class="ttdef"><b>Definition:</b> StaticStealableQueue.hpp:255</div></div>
<div class="ttc" id="classVoxx_1_1Conky_1_1ThreadPool_html_a81a84af47e07fb0c71fa57cec712182e"><div class="ttname"><a href="classVoxx_1_1Conky_1_1ThreadPool.html#a81a84af47e07fb0c71fa57cec712182e">Voxx::Conky::ThreadPool::~ThreadPool</a></div><div class="ttdeci">~ThreadPool() noexcept</div><div class="ttdoc">Destructor  joins the threads. </div><div class="ttdef"><b>Definition:</b> ThreadPool.hpp:180</div></div>
<div class="ttc" id="StaticStealableQueue_8hpp_html"><div class="ttname"><a href="StaticStealableQueue_8hpp.html">StaticStealableQueue.hpp</a></div><div class="ttdoc">This file provides the definition of a fixed size, lock-free, steable queue. </div></div>
<div class="ttc" id="classVoxx_1_1Conky_1_1ThreadPool_html_a224ea04d1be262820d942f781353e69d"><div class="ttname"><a href="classVoxx_1_1Conky_1_1ThreadPool.html#a224ea04d1be262820d942f781353e69d">Voxx::Conky::ThreadPool::process</a></div><div class="ttdeci">void process(std::size_t workerId)</div><div class="ttdoc">Processes tasks using the workerId thread and the workerId worker. </div><div class="ttdef"><b>Definition:</b> ThreadPool.hpp:325</div></div>
<div class="ttc" id="classVoxx_1_1Conky_1_1ThreadPool_html_a391a28760a2639e432f63e4bfe68d391"><div class="ttname"><a href="classVoxx_1_1Conky_1_1ThreadPool.html#a391a28760a2639e432f63e4bfe68d391">Voxx::Conky::ThreadPool::Threads</a></div><div class="ttdeci">ThreadContainer Threads</div><div class="ttdoc">The threads for the pool. </div><div class="ttdef"><b>Definition:</b> ThreadPool.hpp:257</div></div>
<div class="ttc" id="classVoxx_1_1Conky_1_1ThreadPool_html_ac3e5ea78b072c672896ea4c0bbc3dd64"><div class="ttname"><a href="classVoxx_1_1Conky_1_1ThreadPool.html#ac3e5ea78b072c672896ea4c0bbc3dd64">Voxx::Conky::ThreadPool::Flags</a></div><div class="ttdeci">FlagContainer Flags</div><div class="ttdoc">Flags to control the workers. </div><div class="ttdef"><b>Definition:</b> ThreadPool.hpp:256</div></div>
<div class="ttc" id="structVoxx_1_1Conky_1_1ThreadPool_1_1StealOverloader_html"><div class="ttname"><a href="structVoxx_1_1Conky_1_1ThreadPool_1_1StealOverloader.html">Voxx::Conky::ThreadPool::StealOverloader</a></div><div class="ttdoc">The StealOverloader struct is used to overload the stealing implementation based on the provided poli...</div><div class="ttdef"><b>Definition:</b> ThreadPool.hpp:99</div></div>
<div class="ttc" id="ThreadPool_8hpp_html_a6afcd0d9a972f4517b317e62fe9b186e"><div class="ttname"><a href="ThreadPool_8hpp.html#a6afcd0d9a972f4517b317e62fe9b186e">Voxx::Conky::StealPolicy</a></div><div class="ttdeci">StealPolicy</div><div class="ttdoc">The StealPolicy enum defines the stealing policy used by the thread pool. </div><div class="ttdef"><b>Definition:</b> ThreadPool.hpp:34</div></div>
<div class="ttc" id="classVoxx_1_1Conky_1_1ThreadPool_html_a6cb0c21fdfe3457231abe6b9c01fcd3d"><div class="ttname"><a href="classVoxx_1_1Conky_1_1ThreadPool.html#a6cb0c21fdfe3457231abe6b9c01fcd3d">Voxx::Conky::ThreadPool::stopThreads</a></div><div class="ttdeci">void stopThreads() noexcept</div><div class="ttdoc">Stops the threads from running. </div><div class="ttdef"><b>Definition:</b> ThreadPool.hpp:207</div></div>
<div class="ttc" id="classVoxx_1_1Conky_1_1ThreadPool_html_a13dadf2d25521153dc53dae7a7f06cbb"><div class="ttname"><a href="classVoxx_1_1Conky_1_1ThreadPool.html#a13dadf2d25521153dc53dae7a7f06cbb">Voxx::Conky::ThreadPool::processImpl</a></div><div class="ttdeci">void processImpl(std::size_t workerId)</div><div class="ttdoc">Process function for the controller thread. </div><div class="ttdef"><b>Definition:</b> ThreadPool.hpp:342</div></div>
<div class="ttc" id="classVoxx_1_1Conky_1_1StaticStealableQueue_html_ad74563cd73ea66a74edd8e8b1cb50dc6"><div class="ttname"><a href="classVoxx_1_1Conky_1_1StaticStealableQueue.html#ad74563cd73ea66a74edd8e8b1cb50dc6">Voxx::Conky::StaticStealableQueue::steal</a></div><div class="ttdeci">OptionalType steal()</div><div class="ttdoc">Steals an object from the top of the queue. </div><div class="ttdef"><b>Definition:</b> StaticStealableQueue.hpp:214</div></div>
<div class="ttc" id="classVoxx_1_1Conky_1_1ThreadPool_html_ae2f5327241efc9ba7e69194b0b110a52"><div class="ttname"><a href="classVoxx_1_1Conky_1_1ThreadPool.html#ae2f5327241efc9ba7e69194b0b110a52">Voxx::Conky::ThreadPool::waitTillIdle</a></div><div class="ttdeci">void waitTillIdle() const noexcept</div><div class="ttdoc">Waits until the thread pool has no work. </div><div class="ttdef"><b>Definition:</b> ThreadPool.hpp:240</div></div>
<div class="ttc" id="classVoxx_1_1Conky_1_1ThreadPool_html"><div class="ttname"><a href="classVoxx_1_1Conky_1_1ThreadPool.html">Voxx::Conky::ThreadPool</a></div><div class="ttdoc">The ThreadPool class creates a thread pool with one controlling thread (which may be extended to be a...</div><div class="ttdef"><b>Definition:</b> ThreadPool.hpp:85</div></div>
<div class="ttc" id="classVoxx_1_1Conky_1_1StaticStealableQueue_html"><div class="ttname"><a href="classVoxx_1_1Conky_1_1StaticStealableQueue.html">Voxx::Conky::StaticStealableQueue&lt; TaskType, TasksPerQueue &gt;</a></div></div>
<div class="ttc" id="classVoxx_1_1Conky_1_1ThreadPool_html_acdc979c231259442c770d1a4eef8709d"><div class="ttname"><a href="classVoxx_1_1Conky_1_1ThreadPool.html#acdc979c231259442c770d1a4eef8709d">Voxx::Conky::ThreadPool::FlagContainer</a></div><div class="ttdeci">std::vector&lt; uint8_t &gt; FlagContainer</div><div class="ttdoc">Defines the type of container for the flags to control the worker threads. </div><div class="ttdef"><b>Definition:</b> ThreadPool.hpp:153</div></div>
<div class="ttc" id="structVoxx_1_1Conky_1_1ThreadPool_1_1TaskQueue_html"><div class="ttname"><a href="structVoxx_1_1Conky_1_1ThreadPool_1_1TaskQueue.html">Voxx::Conky::ThreadPool::TaskQueue</a></div><div class="ttdoc">The TaskQueue defines a correctly aligned queue of tasks for a thread. </div><div class="ttdef"><b>Definition:</b> ThreadPool.hpp:121</div></div>
<div class="ttc" id="classVoxx_1_1Conky_1_1ThreadPoolException_html_a7d8dde22259d9772d9d6f80802c9e77da7b457d5bd516de9bd23b261f3e38cda6"><div class="ttname"><a href="classVoxx_1_1Conky_1_1ThreadPoolException.html#a7d8dde22259d9772d9d6f80802c9e77da7b457d5bd516de9bd23b261f3e38cda6">Voxx::Conky::ThreadPoolException::Type::Oversubscription</a></div><div class="ttdoc">More threads than cores. </div></div>
<div class="ttc" id="classVoxx_1_1Conky_1_1ThreadPool_html_a2c219ac4227a19f806110246c349f561"><div class="ttname"><a href="classVoxx_1_1Conky_1_1ThreadPool.html#a2c219ac4227a19f806110246c349f561">Voxx::Conky::ThreadPool::startThreads</a></div><div class="ttdeci">void startThreads() noexcept</div><div class="ttdoc">Starts the threads running. </div><div class="ttdef"><b>Definition:</b> ThreadPool.hpp:218</div></div>
<div class="ttc" id="namespaceVoxx_html"><div class="ttname"><a href="namespaceVoxx.html">Voxx</a></div><div class="ttdef"><b>Definition:</b> StaticStealableQueue.hpp:25</div></div>
<div class="ttc" id="classVoxx_1_1Conky_1_1ThreadPool_html_abc541275693b3cd0b99759ef2802a511"><div class="ttname"><a href="classVoxx_1_1Conky_1_1ThreadPool.html#abc541275693b3cd0b99759ef2802a511">Voxx::Conky::ThreadPool::tryPush</a></div><div class="ttdeci">bool tryPush(TaskCallable &amp;&amp;callable, TaskArgs &amp;&amp;... args)</div><div class="ttdoc">Tries to push an object onto the worker queue for the current thread. </div><div class="ttdef"><b>Definition:</b> ThreadPool.hpp:194</div></div>
<div class="ttc" id="Thread_8hpp_html"><div class="ttname"><a href="Thread_8hpp.html">Thread.hpp</a></div><div class="ttdoc">This file defines thread related functionality. </div></div>
<div class="ttc" id="classVoxx_1_1Conky_1_1ThreadPool_html_a04db1c102afea56bd8e91c43a88ae34b"><div class="ttname"><a href="classVoxx_1_1Conky_1_1ThreadPool.html#a04db1c102afea56bd8e91c43a88ae34b">Voxx::Conky::ThreadPool::restartThreads</a></div><div class="ttdeci">void restartThreads()</div><div class="ttdoc">Restarts the threads. </div><div class="ttdef"><b>Definition:</b> ThreadPool.hpp:298</div></div>
<div class="ttc" id="classVoxx_1_1Conky_1_1ThreadPool_html_ac2afd11f433203a5408138b610729df1"><div class="ttname"><a href="classVoxx_1_1Conky_1_1ThreadPool.html#ac2afd11f433203a5408138b610729df1">Voxx::Conky::ThreadPool::TaskQueues</a></div><div class="ttdeci">QueueContainer TaskQueues</div><div class="ttdoc">The queues of tasks for each thread. </div><div class="ttdef"><b>Definition:</b> ThreadPool.hpp:258</div></div>
<div class="ttc" id="classVoxx_1_1Conky_1_1ThreadPool_html_ab9ba93f24dae63fa4361b01bc970d4a6"><div class="ttname"><a href="classVoxx_1_1Conky_1_1ThreadPool.html#ab9ba93f24dae63fa4361b01bc970d4a6">Voxx::Conky::ThreadPool::steal</a></div><div class="ttdeci">void steal(std::size_t workerId, NNeighbourSteal tag)</div><div class="ttdoc">Defines the implemenation of the stealing method when the stealing policy is to steal from the neares...</div><div class="ttdef"><b>Definition:</b> ThreadPool.hpp:365</div></div>
<div class="ttc" id="Task_8hpp_html"><div class="ttname"><a href="Task_8hpp.html">Task.hpp</a></div><div class="ttdoc">This file provides the definition of a task class. </div></div>
<div class="ttc" id="classVoxx_1_1Conky_1_1ThreadPool_html_a0159256530cb47af45cf42a848109e46"><div class="ttname"><a href="classVoxx_1_1Conky_1_1ThreadPool.html#a0159256530cb47af45cf42a848109e46">Voxx::Conky::ThreadPool::runningThreads</a></div><div class="ttdeci">std::size_t runningThreads() const noexcept</div><div class="ttdoc">Returns the number of threads which are running. </div><div class="ttdef"><b>Definition:</b> ThreadPool.hpp:232</div></div>
<div class="ttc" id="classVoxx_1_1Conky_1_1ThreadPoolException_html"><div class="ttname"><a href="classVoxx_1_1Conky_1_1ThreadPoolException.html">Voxx::Conky::ThreadPoolException</a></div><div class="ttdoc">The ThreadPoolException class overrides the standard exception class to define thread pool related ex...</div><div class="ttdef"><b>Definition:</b> ThreadPoolException.hpp:27</div></div>
<div class="ttc" id="classVoxx_1_1Conky_1_1ThreadPool_html_a6e711954f70e25be86d01b32562d12e3"><div class="ttname"><a href="classVoxx_1_1Conky_1_1ThreadPool.html#a6e711954f70e25be86d01b32562d12e3">Voxx::Conky::ThreadPool::isEmpty</a></div><div class="ttdeci">bool isEmpty() const noexcept</div><div class="ttdoc">Returns true if the thread pool has no more work, otherwise it returns false. </div><div class="ttdef"><b>Definition:</b> ThreadPool.hpp:246</div></div>
<div class="ttc" id="classVoxx_1_1Conky_1_1ThreadPool_html_ad156d5942b00d229c41915c94cfbc64c"><div class="ttname"><a href="classVoxx_1_1Conky_1_1ThreadPool.html#ad156d5942b00d229c41915c94cfbc64c">Voxx::Conky::ThreadPool::makeWorkersRunnable</a></div><div class="ttdeci">void makeWorkersRunnable() noexcept</div><div class="ttdoc">Sets the worker flags to enable them to start running. </div><div class="ttdef"><b>Definition:</b> ThreadPool.hpp:277</div></div>
<div class="ttc" id="ThreadPoolException_8hpp_html"><div class="ttname"><a href="ThreadPoolException_8hpp.html">ThreadPoolException.hpp</a></div><div class="ttdoc">This file provides the definition of an exception class for thread pool related exceptions. </div></div>
<div class="ttc" id="classVoxx_1_1Conky_1_1ThreadPool_html_acf67028a501af41702b50c666ee8a4ce"><div class="ttname"><a href="classVoxx_1_1Conky_1_1ThreadPool.html#acf67028a501af41702b50c666ee8a4ce">Voxx::Conky::ThreadPool::join</a></div><div class="ttdeci">void join() noexcept</div><div class="ttdoc">Joins the threads. </div><div class="ttdef"><b>Definition:</b> ThreadPool.hpp:284</div></div>
<div class="ttc" id="classVoxx_1_1Conky_1_1ThreadPool_html_a5293f196b6d53fb76105ff11141bf739"><div class="ttname"><a href="classVoxx_1_1Conky_1_1ThreadPool.html#a5293f196b6d53fb76105ff11141bf739">Voxx::Conky::ThreadPool::createWorkers</a></div><div class="ttdeci">void createWorkers(std::size_t numThreads)</div><div class="ttdoc">Creates the worker threads. </div><div class="ttdef"><b>Definition:</b> ThreadPool.hpp:270</div></div>
<div class="ttc" id="classVoxx_1_1Conky_1_1StaticStealableQueue_html_ad998a47e79e51b7edcba2f53e30d6380"><div class="ttname"><a href="classVoxx_1_1Conky_1_1StaticStealableQueue.html#ad998a47e79e51b7edcba2f53e30d6380">Voxx::Conky::StaticStealableQueue::push</a></div><div class="ttdeci">void push(ObjectArgs &amp;&amp;... args)</div><div class="ttdoc">Pushes an object onto the front of the queue, when the object is an rvalue reference type...</div><div class="ttdef"><b>Definition:</b> StaticStealableQueue.hpp:111</div></div>
<div class="ttc" id="classVoxx_1_1Conky_1_1ThreadPool_html_a58e403696928c7b974efb78c4e628b88"><div class="ttname"><a href="classVoxx_1_1Conky_1_1ThreadPool.html#a58e403696928c7b974efb78c4e628b88">Voxx::Conky::ThreadPool::ThreadContainer</a></div><div class="ttdeci">std::vector&lt; std::thread &gt; ThreadContainer</div><div class="ttdoc">Defines the type of thread container. </div><div class="ttdef"><b>Definition:</b> ThreadPool.hpp:157</div></div>
<div class="ttc" id="classVoxx_1_1Conky_1_1ThreadPool_html_a3ea01dcd3f395c76225fb2d4982faeed"><div class="ttname"><a href="classVoxx_1_1Conky_1_1ThreadPool.html#a3ea01dcd3f395c76225fb2d4982faeed">Voxx::Conky::ThreadPool::runnable</a></div><div class="ttdeci">bool runnable(std::size_t workerId) const noexcept</div><div class="ttdoc">Allows a worker thread with workerId to check if it must still run. </div><div class="ttdef"><b>Definition:</b> ThreadPool.hpp:265</div></div>
<div class="ttc" id="classVoxx_1_1Conky_1_1ThreadPool_html_a622696b6cfc49ad93a79cab5c6aeab26"><div class="ttname"><a href="classVoxx_1_1Conky_1_1ThreadPool.html#a622696b6cfc49ad93a79cab5c6aeab26">Voxx::Conky::ThreadPool::steal</a></div><div class="ttdeci">void steal(std::size_t workerId, RandomSteal tag)</div><div class="ttdoc">Defines the implemenation of the stealing method when the stealing policy is to steal randomly from a...</div><div class="ttdef"><b>Definition:</b> ThreadPool.hpp:354</div></div>
</div><!-- fragment --></div><!-- contents -->
<footer class="page-footer">
  <!--div class="container"-->
    <div class="row">
      <div class="col s0 m2 l3">
        <!-- Padding -->
      </div>
      <div class="col s12 m8 l6">
        <div class="left">
          <h5 class="blue-grey-text text-darken-1"><!-- Main footer content--></h5>
          <p class="blue-grey-text text-darken-1"><!--More content --></p>
        </div>
        <div class="right">
          <h5 class="blue-text text-darken-4"><!--Links --></h5>
        </div>
      </div>
      <div class="col s0 m2 l3">
        <!-- Padding -->
      </div>
    </div>
  </div>
  <div class="footer-copyright">
    <div class="row">
      <div class="col s0 m2 l3">
      </div>
      <div class="col s12 m8 l6">
        <div class="left">
           2017 Rob Clucas
        </div>
        <div class="right">
          <a class="grey-text text-lighten-4" href="#!"><!--More links--></a>
        </div>
      </div>
      <div class="col s0 m2 l3">
      </div>
    </div>
  </div>
  <!--/div-->
</footer>
